model PushSubscription {
  id            String    @id @default(cuid())
  endpoint      String    @unique
  auth          String
  p256dh        String
  userId        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastSuccessAt DateTime?
  lastFailureAt DateTime?
  failedCount   Int       @default(0)
  user          User?     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model TopicSubscription {
  id        String    @id @default(cuid())
  topic     String
  createdAt DateTime  @default(now())
  inApp     Boolean   @default(true)
  push      Boolean   @default(true)
  userId    String
  frequency Frequency @default(immediate)
  user      User      @relation(fields: [userId], references: [id])

  @@unique([userId, topic])
  @@index([topic])
}

model Notification {
  id           String    @id @default(cuid())
  userId       String
  topic        String
  title        String
  body         String?
  url          String?
  metadata     Json?
  createdAt    DateTime  @default(now())
  pushedAt     DateTime?
  pushAttempts Int       @default(0)
  readAt       DateTime?
  user         User      @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
  @@index([topic, createdAt])
}

enum Frequency {
  immediate
  hourly
  daily
}
